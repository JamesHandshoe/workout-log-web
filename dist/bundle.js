$(document).ready(function(){var o=function(o,e){var t="//workoutapi-1150-jhandshoe.herokuapp.com/api/",i=function(e){window.localStorage.setItem("sessionToken",e),o.ajaxSetup({headers:{Authorization:e}})};return{API_BASE:t,setAuthHeader:i}}(jQuery);$(".nav-tabs a[data-toggle=tab]").on("click",function(o){var e=window.localStorage.getItem("sessionToken");if($(this).hasClass("disabled")&&!e)return o.preventDefault(),!1}),$("a[data-toggle=tab]").on("shown.bs.tab",function(e){var t=$(e.target).attr("href");"#log"===t&&o.log.setDefinitions(),"#history"===t&&o.log.setHistory()});var e=window.localStorage.getItem("sessionToken");e&&o.setAuthHeader(e),window.WorkoutLog=o}),$(function(){$("#define-success").hide(),$("#define-fail").hide(),$.extend(WorkoutLog,{definition:{userDefinitions:[],create:function(){var o={desc:$("#def-description").val(),type:$("#def-logtype").val()},e={definition:o},t=$.ajax({type:"POST",url:WorkoutLog.API_BASE+"definition",data:JSON.stringify(e),contentType:"application/json"});t.done(function(o){WorkoutLog.definition.userDefinitions.push(o.definition),$("#define-success").fadeIn(),$("#def-description").val()}),t.fail(function(o){console.log("oh no"+JSON.stringify(o)),$("#define-fail").fadeIn()})},"delete":function(){var o={id:$("#log-definition").find("option:selected").val()},e={definition:o},t=$.ajax({type:"DELETE",url:WorkoutLog.API_BASE+"definition",data:JSON.stringify(e),contentType:"application/json"});$("select option:selected").text(""),$("select option:selected").hide();for(var i=0;i<WorkoutLog.definition.userDefinitions.length;i++)WorkoutLog.definition.userDefinitions[i].id==o.id&&WorkoutLog.definition.userDefinitions.splice(i,1);t.fail(function(){console.log("nope. you didn't delete category.")})},fetchAll:function(){$.ajax({type:"GET",url:WorkoutLog.API_BASE+"definition",headers:{Authorization:window.localStorage.getItem("sessionToken")}}).done(function(o){WorkoutLog.definition.userDefinitions=o}).fail(function(o){console.log(o)})}}}),$("#def-save").on("click",WorkoutLog.definition.create),$("#delete-category").on("click",WorkoutLog.definition["delete"]),window.localStorage.getItem("sessionToken")&&WorkoutLog.definition.fetchAll()});var index;$(function(){$("#log-success").hide(),$("#log-fail").hide(),$.extend(WorkoutLog,{log:{workouts:[],setDefinitions:function(){for(var o=WorkoutLog.definition.userDefinitions,e=o.length,t="",i=0;i<e;i++)t+="<option value='"+o[i].id+"'>"+o[i].description+"</option>";$("#log-definition").children().remove(),$("#log-definition").append(t)},setHistory:function(){for(var o=WorkoutLog.log.workouts,e=o.length,t="",i=0;i<e;i++)t+="<li class='list-group-item'>"+o[i].def+" - "+o[i].result+" <button id='"+o[i].id+"' class='remove'><strong>X</strong></button></li>";$("#history-list").children().remove(),$("#history-list").append(t)},create:function(){var o={desc:$("#log-description").val(),result:$("#log-result").val(),def:$("#log-definition option:selected").text()},e={log:o},t=$.ajax({type:"POST",url:WorkoutLog.API_BASE+"log",data:JSON.stringify(e),contentType:"application/json"});t.done(function(o){WorkoutLog.log.workouts.push(o),$("#log-success").fadeIn(),$("#log-result").val(""),$("#log-description").val("")}),t.fail(function(){console.log("something broke"),$("#log-fail").fadeIn()})},"delete":function(){var o={id:$(this).attr("id")},e={log:o},t=$.ajax({type:"DELETE",url:WorkoutLog.API_BASE+"log",data:JSON.stringify(e),contentType:"application/json"});$(this).closest("li").remove();for(var i=0;i<WorkoutLog.log.workouts.length;i++)WorkoutLog.log.workouts[i].id==o.id&&WorkoutLog.log.workouts.splice(i,1);t.fail(function(){console.log("nope. you didn't delete it.")})},fetchAll:function(){var o=$.ajax({type:"GET",url:WorkoutLog.API_BASE+"log",header:{Authorization:window.localStorage.getItem("sessionToken")}});o.done(function(o){WorkoutLog.log.workouts=o}),o.fail(function(o){console.log("an error occured"+o.message)})}}}),$("#log-save").on("click",WorkoutLog.log.create),$("#history-list").delegate(".remove","click",WorkoutLog.log["delete"]),window.localStorage.getItem("sessionToken")&&WorkoutLog.log.fetchAll()}),$(function(){$.extend(WorkoutLog,{afterSignin:function(o){WorkoutLog.setAuthHeader(o),WorkoutLog.definition.fetchAll(),WorkoutLog.log.fetchAll(),$(".disabled").removeClass("disabled"),$("#loginout").text("Logout")},signup:function(){var o=$("#su_username").val(),e=$("#su_password").val(),t={user:{username:o,password:e}},i=$.ajax({type:"POST",url:WorkoutLog.API_BASE+"user",data:JSON.stringify(t),contentType:"application/json"});i.done(function(o){o.sessionToken&&$("#signup-modal").modal("hide"),$('.nav-tabs a[href="#define"]').tab("show")}).fail(function(){$("#su_error").text("There was an issue with sign up").show()})},login:function(){var o=$("#li_username").val(),e=$("#li_password").val(),t={user:{username:o,password:e}},i=$.ajax({type:"POST",url:WorkoutLog.API_BASE+"login",data:JSON.stringify(t),contentType:"application/json"});i.done(function(e){e.sessionToken&&(WorkoutLog.afterSignin(e.sessionToken),$("#login-modal").modal("hide"),$('.nav-tabs a[href="#log"]').tab("show"),$("#welcome").show(),$("#welcome").text("Welcome, "+o))}).fail(function(){$("#li_error").text("There was an issue with sign up").show()})},loginout:function(){window.localStorage.getItem("sessionToken")&&(window.localStorage.removeItem("sessionToken"),$("#loginout").text("Login"))}}),$("#login").on("click",WorkoutLog.login),$("#signup").on("click",WorkoutLog.signup),$("#loginout").on("click",WorkoutLog.loginout),window.localStorage.getItem("sessionToken")&&$("#loginout").text("Logout")});